{% extends "repo_base.html" %}
{% load staticfiles %}
{% block title %}Listing{% endblock %}
{% block content %}

<div class="container container-search">
  <div class="row row-search">
    <form class="form-inline" method="GET" action="{% url 'repositories' repo.slug %}">
      <div class="col-md-12 input-group">
        <input
           id="id_q" name="q" type="search"
           class="form-control input-lg input-search col-md-12"
           placeholder="Search..."
           {% if form.q.value %}value="{{ form.q.value }}"{% endif %}
         >
        <span class="input-group-btn">
          <button type="submit" class="btn btn-default btn-lg">
            <i class="fa fa-search"></i>
          </button>
        </span>
      </div>
    </form>
  </div>
</div>
<div class="col-md-3">
  <div class="panel-group lore-panel-group">
    {% if facets.fields.course %}
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title">
          <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapse-1">
            Course
          </a>
        </h4>
      </div>
      <div id="collapse-1" class="panel-collapse collapse in">
        <div class="panel-body">
          <ul class="icheck-list">
            {% for course in facets.fields.course %}
            <li>
              <a href="{% url 'repositories' repo.slug %}{{ qs_prefix }}selected_facets=course_exact:{{ course.0|urlencode }}">
                {{ course.0 }}
              </a>
              <span class="badge">{{ course.1 }}</span>
            </li>
            {% endfor %}
          </ul>
          {% endif %}
        </div>
      </div>
    </div>
    {% if facets.fields.run %}
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title">
          <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapse-2">
            Run
          </a>
        </h4>
      </div>
      <div id="collapse-2" class="panel-collapse collapse in">
        <div class="panel-body">
          <ul class="icheck-list">
            {% for run in facets.fields.run %}
            <li>
              <a href="{% url 'repositories' repo.slug %}{{ qs_prefix }}selected_facets=run_exact:{{ run.0|urlencode }}">
                {{ run.0 }}
              </a>
              <span class="badge">{{ run.1 }}</span>
            </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
    {% endif %}
    {% if facets.fields.resource_type %}
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title">
          <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapse-3">
            Item Type
          </a>
        </h4>
      </div>
      <div id="collapse-3" class="panel-collapse collapse in">
        <div class="panel-body">
          <ul class="icheck-list">
            {% for resource_type in facets.fields.resource_type %}
            <li>
              <a href="{% url 'repositories' repo.slug %}{{ qs_prefix }}selected_facets=resource_type_exact:{{ resource_type.0|urlencode }}">        
                {# Select image based on type #}
                {% if resource_type.0 == 'chapter' %}
                <img class="ic-custom" height="18" width="24"
                     src="{% static "ui/images/ic-book.png" %}">
                {% elif resource_type.0 == 'sequential' %}
                <img class="ic-custom" height="18" width="24"
                     src="{% static "ui/images/ic-sequential.png" %}">
                {% elif resource_type.0 == 'vertical' %}
                <img class="ic-custom" height="18" width="24"
                     src="{% static "ui/images/ic-vertical.png" %}">
                {% elif resource_type.0 == 'problem' %}
                <img class="ic-custom" height="18" width="24"
                     src="{% static "ui/images/ic-pieces.png" %}">
                {% elif resource_type.0 == 'video' %}
                <img class="ic-custom" height="18" width="24"
                     src="{% static "ui/images/ic-video.png" %}">
                {% else %}
                <img class="ic-custom" height="18" width="24"
                     src="{% static "ui/images/ic-code.png" %}">
                {% endif %}                  
                {{ resource_type.0|title }}
              </a>
              <span class="badge">{{ resource_type.1 }}</span>
            </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
    {% for name, vocab in vocabularies.items %}
    {% if vocab %}
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title">
          <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapse-vocab-{{ forloop.counter }}">
            {{ name|title }}
          </a>
        </h4>
      </div>
      <div id="collapse-vocab-{{ forloop.counter }}" class="panel-collapse collapse in">
        <div class="panel-body">
          <ul class="icheck-list">
            {% for term in vocab %}
            <li>
              <a href="{% url 'repositories' repo.slug %}{{ qs_prefix }}selected_facets={{ name|urlencode }}_exact:{{ term.0|urlencode }}">
                {{ term.0 }}
              </a>
              <span class="badge">{{ term.1 }}</span>
            </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
    {% endif %}
    {% endfor %}
  </div>
  {% endif %}
</div>
<div class="col-md-9 col-results">
  <div class="row grid-row-top">
    <div class="col-md-5"></div>
    <div class="col-md-7 text-right"></div>
  </div>
  {% for result in page.object_list %}
  <div class="row">
    <div class="col-md-10">
      <div class="tile">
        <div class="tile-icon tile-color-1">
          {# Select image based on type #}
          {% if result.resource_type == 'chapter' %}
          <img class="ic-custom" height="18" width="24"
               src="{% static "ui/images/ic-book.png" %}">
          {% elif result.resource_type == 'sequential' %}
          <img class="ic-custom" height="18" width="24"
               src="{% static "ui/images/ic-sequential.png" %}">
          {% elif result.resource_type == 'vertical' %}
          <img class="ic-custom" height="18" width="24"
               src="{% static "ui/images/ic-vertical.png" %}">
          {% elif result.resource_type == 'problem' %}
          <img class="ic-custom" height="18" width="24"
               src="{% static "ui/images/ic-pieces.png" %}">
          {% elif result.resource_type == 'video' %}
          <img class="ic-custom" height="18" width="24"
               src="{% static "ui/images/ic-video.png" %}">
          {% else %}
          <img class="ic-custom" height="18" width="24"
               src="{% static "ui/images/ic-code.png" %}">
          {% endif %}
        </div>
        <div class="tile-content">
          <h2>
            <a href="{% url 'export' repo.slug result.object.id %}" class="cd-btn">
              {% if result.object.title %}
              {{ result.object.title }}
              {% else %}
              No Title
              {% endif %}
            </a>
          </h2>
          
          <div class="tile-blurb">
            {% if result.object.description %}
            {{ result.object.description }}
            {% else %}
            No description provided.
            {% endif %}
          </div>
          <div class="tile-meta">
            <span class="meta-item">{{ result.object.course.course_number }}</span>
            <span class="meta-item">{{ result.object.course.run }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

<div class="row">
  <div class="col-md-12">
    <div class="lore-pagination">
      {% if page.has_other_pages %}
      {% if page.has_previous %}
      <a href="{% url 'repositories' repo.slug %}{{ qs_prefix }}page={{ page.previous_page_number }}"><i
                                                                                                         class="fa fa-angle-left"></i></a>
      {% endif %}
      
      {% if page.has_next %}
      <a href="{% url 'repositories' repo.slug %}{{ qs_prefix }}page={{ page.next_page_number }}"><i
                                                                                                     class="fa fa-angle-right"></i></a>
      {% endif %}
      {% endif %}
    </div>
  </div>
</div>
{% include "includes/resource_panel.html" %}

{% endblock %}
